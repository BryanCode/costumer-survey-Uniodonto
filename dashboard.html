<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: #E0FF7A;
            padding: 20px;
        }
        .accordion-button:not(.collapsed) {
            color: #A60069;
            background-color: #e7f1ff;
        }
        .accordion-button {
            color: #A60069;
        }
        .accordion-body {
            color: #A60069;
        }
        .positive-feedback {
            background-color: #d4edda;
        }
        .negative-feedback {
            background-color: #f8d7da;
        }
        .accordion-item {
            margin-bottom: 1rem;
        }
        .worst-feedback {
            background-color: rgba(241, 200, 200, 0.753);
        }
        .excellent-feedback {
            background-color: rgba(143, 221, 143, 0.658);
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="mb-4" style="color: #A60069;">Pesquisa de satisfação - Dashboard</h1>
    <button id="refreshButton" class="btn btn-primary mb-4" style="background-color: #A60069; border-color: #A60069;"><i class="fa-solid fa-rotate"></i></button>

    <div class="accordion" id="feedbackAccordion">
        <!-- Feedback items will be inserted here -->
    </div>
    <table  class="d-none table table-bordered metrics-table">
        <thead>
            <tr>
                <th>Total de Avaliações</th>
                <th>Média de Aparência do Consultório</th>
                <th>Média de Clareza da Comunicação</th>
                <th>Média de Competência do Dentista</th>
                <th>Média de Confiança Transmitida</th>
                <th>Média de Cortesia do Dentista</th>
                <th>Média de Cortesia da Recepção</th>
                <th>Média de Qualidade dos Equipamentos</th>
            </tr>
        </thead>
        <tbody id="metricsTableBody">
            <!-- Metrics will be inserted here -->
        </tbody>
    </table>
</div>

<script>

    document.getElementById('refreshButton').addEventListener('click', function() {
        location.reload();
    });

     document.addEventListener('DOMContentLoaded', function() {
        fetch('https://satisfaction-survey-25a8f-default-rtdb.firebaseio.com/avaliacaoAtendimento.json')
            .then(response => response.json())
            .then(data => {
                const feedbackAccordion = document.getElementById('feedbackAccordion');
                let feedbackHtml = '';

                let totalAvaliacoes = 0;
                let somaAparenciaConsultorio = 0;
                let somaClarezaComunicacao = 0;
                let somaCompetenciaDentista = 0;
                let somaConfiancaTransmitida = 0;
                let somaCortesiaDentista = 0;
                let somaCortesiaRecepcao = 0;
                let somaQualidadeEquipamentos = 0;

                Object.keys(data).forEach((key, index) => {
                    const feedback = data[key];
                    totalAvaliacoes++;

                    const aparenciaConsultorio = convertRatingToNumber(feedback.aparenciaConsultorio);
                    const clarezaComunicacao = convertRatingToNumber(feedback.clarezaCominicacao);
                    const competenciaDentista = convertRatingToNumber(feedback.competenciaDentista);
                    const confiancaTransmitida = convertRatingToNumber(feedback.confiancaTransmitida);
                    const cortesiaDentista = convertRatingToNumber(feedback.cortesiaDentista);
                    const cortesiaRecepcao = convertRatingToNumber(feedback.cortesiaRecepcao);
                    const qualidadeEquipamentos = convertRatingToNumber(feedback.qualidadeEquipamentos);

                    somaAparenciaConsultorio += aparenciaConsultorio;
                    somaClarezaComunicacao += clarezaComunicacao;
                    somaCompetenciaDentista += competenciaDentista;
                    somaConfiancaTransmitida += confiancaTransmitida;
                    somaCortesiaDentista += cortesiaDentista;
                    somaCortesiaRecepcao += cortesiaRecepcao;
                    somaQualidadeEquipamentos += qualidadeEquipamentos;

                    let satisfactionClass = '';
                    if (feedback.satisfacaoGeral.toLowerCase() === 'péssimo') {
                        satisfactionClass = 'worst-feedback';
                    } else if (feedback.satisfacaoGeral.toLowerCase() === 'excelente') {
                        satisfactionClass = 'excellent-feedback';
                    }

                    feedbackHtml += `
                        <div class="accordion-item ${satisfactionClass}">
                            <h2 class="accordion-header" id="heading${index}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}">
                                    ${feedback.nomePacientente || 'Anônimo'} - ${feedback.dataAtendimento}
                                </button>
                            </h2>
                            <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#feedbackAccordion">
                                <div class="accordion-body">
                                    <p><strong>Tipo de Atendimento:</strong> ${feedback.tipoAtendimento}</p>
                                    <p><strong>Data do Atendimento:</strong> ${feedback.dataAtendimento}</p>
                                    <p><strong>Aparência do Consultório:</strong> ${feedback.aparenciaConsultorio}</p>
                                    <p><strong>Clareza da Comunicação:</strong> ${feedback.clarezaCominicacao}</p>
                                    <p><strong>Competência do Dentista:</strong> ${feedback.competenciaDentista}</p>
                                    <p><strong>Confiança Transmitida:</strong> ${feedback.confiancaTransmitida}</p>
                                    <p><strong>Cortesia do Dentista:</strong> ${feedback.cortesiaDentista}</p>
                                    <p><strong>Cortesia da Recepção:</strong> ${feedback.cortesiaRecepcao}</p>
                                    <p><strong>Qualidade dos Equipamentos:</strong> ${feedback.qualidadeEquipamentos}</p>
                                    <p><strong>Rastreio do Paciente:</strong> ${feedback.rastreioPaciente}</p>
                                    <p><strong>Satisfação Geral:</strong> ${feedback.satisfacaoGeral}</p>
                                    <p><strong>Sugestão/Comentário:</strong> ${feedback.sugestaoComentario || 'Nenhum'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });

                feedbackAccordion.innerHTML = feedbackHtml;

                const metricsTableBody = document.getElementById('metricsTableBody');
                metricsTableBody.innerHTML = `
                    <tr>
                        <td>${totalAvaliacoes}</td>
                        <td>${(somaAparenciaConsultorio / totalAvaliacoes).toFixed(2)}</td>
                        <td>${(somaClarezaComunicacao / totalAvaliacoes).toFixed(2)}</td>
                        <td>${(somaCompetenciaDentista / totalAvaliacoes).toFixed(2)}</td>
                        <td>${(somaConfiancaTransmitida / totalAvaliacoes).toFixed(2)}</td>
                        <td>${(somaCortesiaDentista / totalAvaliacoes).toFixed(2)}</td>
                        <td>${(somaCortesiaRecepcao / totalAvaliacoes).toFixed(2)}</td>
                        <td>${(somaQualidadeEquipamentos / totalAvaliacoes).toFixed(2)}</td>
                    </tr>
                `;
            })
            .catch(error => console.error('Error fetching data:', error));

        function convertRatingToNumber(rating) {
            switch (rating.toLowerCase()) {
                case 'péssimo': return 1;
                case 'ruim': return 2;
                case 'regular': return 3;
                case 'bom': return 4;
                case 'excelente': return 5;
                default: return 0;
            }
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
